# Compare leaflet coaptation fractions

The case-control variable is `type`.

Comparison variables are

* `nr_frac` Fraction of coaptation area between non-coronary and right coronary leaflets of total coaptation area
* `rl_frac` Fraction of coaptation area between right and left coronary leaflets of total coaptation area
* `ln_frac` Fraction of coaptation area between left coronary and non-coronary leaflets of total coaptation areas

[PNG](../figures/densityLeafletsCoapFrac.png), [SVG](../figures/densityLeafletCoapFrac.svg)

![Density plot](../figures/densityLeafletsCoapFrac.png)

```{r densityLeafletsCoapFrac, fig.show = "hide"}
var <- "^id|^type$|_frac$"
df1 <-
  df %>%
  select(matches(var)) %>%
  melt(id.vars = c("id", "type")) %>% 
  mutate(type = factor(type))
df1 %>% 
  mutate(variable = factor(variable,
                           levels = c("nr_frac", "rl_frac", "ln_frac"),
                           labels = c("NR fraction", "RL fraction", "LN fraction"))) %>% 
  ggplot +
  aes(x = value, color = type, fill = type) +
  geom_vline(xintercept = 0.33) +
  geom_density(alpha = 1/3) +
  scale_x_continuous("") +
  scale_y_continuous("", labels = NULL) +
  scale_color_brewer("", palette = "Set1") +
  scale_fill_brewer("", palette = "Set1") +
  facet_wrap(~ variable, ncol = 4, scales = "free") +
  theme_bw() +
  theme(legend.position = "bottom",
        panel.grid = element_blank(),
        axis.ticks.y = element_blank())
ggsave("../figures/densityLeafletsCoapFrac.png", dpi = 300, height = 3, width = 9, units = "in")
ggsave("../figures/densityLeafletsCoapFrac.svg", dpi = 300, height = 3, width = 9, units = "in")
```

[PNG](../figures/lineplotsLeafletsCoapFrac.png), [SVG](../figures/lineplotsLeafletCoapFrac.svg)

![Density plot](../figures/lineplotsLeafletsCoapFrac.png)

```{r lineplotsLeafletsCoapFrac, fig.show = "hide"}
df1 %>% 
  mutate(variable = factor(variable,
                           levels = c("nr_frac", "rl_frac", "ln_frac"),
                           labels = c("NR", "RL", "LN"))) %>% 
  ggplot +
  aes(x = variable, y = value, color = type) +
  geom_hline(yintercept = 1/3) +
  geom_line(alpha = 1/4, aes(group = id)) +
  geom_boxplot(alpha = 1/2, aes(fill = type)) +
  # geom_point(alpha = 1/2, aes(group = id)) +
  scale_x_discrete("") +
  scale_y_continuous("Coaptation area fraction") +
  scale_color_brewer("", palette = "Set1") +
  scale_fill_brewer("", palette = "Set1") +
  facet_wrap(~ type) +
  theme_bw() +
  theme(legend.position = "none",
        panel.grid.major.x = element_blank())
ggsave("../figures/lineplotsLeafletsCoapFrac.png", dpi = 300, height = 4, width = 8, units = "in")
ggsave("../figures/lineplotsLeafletsCoapFrac.svg", dpi = 300, height = 4, width = 8, units = "in")
```


```{r}
M <- 
  df %>%
  select(matches(var)) %>%
  manova(cbind(nr_frac, rl_frac, ln_frac) ~ type, data = .)
summary.aov(M)
summary.manova(M)
```

```{r}
compare("sdLeafletFrac", "Standard deviation of leaflet fractions") %>% 
  kable
```




## Unadjusted/unscaled comparisons

Calculate mean (SD) and ranges.
Calculate differences in means.
Adjust p-values for multiple comparisons.

```{r}
results <- 
  rbind(compare("bsa", "Body surface area"),
        compare("nr_frac", "NR fraction"),
        compare("rl_frac", "RL fraction"),
        compare("ln_frac", "LN fraction"),
        compare("sdLeafletFrac", "Standard deviation of leaflet fractions"),
        compare("total_area_value", "Total coaptation area, value"),
        compare("total_area", "Total coaptation area, calculated"),
        compare("orifice_area", "Orifice area"),
        compare("valve_diameter", "Valve diameter"),
        compare("valve_area", "Valve area"),
        compare("a_coap_size_valve", "Total valve coaptation area relative to valve diameter"),
        compare("a_coap_orifice_area", "Total valve coaptation area relative to orifice area"),
        compare("a_coap_valve_area", "Total valve coaptation area relative to valve area"),
        compare("magnitude", "Coaptation line length"),
        compare("centroidCalcRotatedX", "Ceiling centroid point X-coordinate"),
        compare("centroidCalcRotatedY", "Ceiling centroid point Y-coordinate")) %>%
  mutate(pAdjust = p.adjust(pValue, method = "BH"),
         sig = pAdjust < 0.05) %>% 
  .[names(.) %>% grep("formula", ., invert = TRUE, value = TRUE) %>% c("formula")]
```

Output results.
Results save as [CSV](../data/processed/compareUnadjusted.csv).

```{r}
results %>% 
  select(matches("variable|meanSD|diff")) %>% 
  select(-matches("seDiff")) %>% 
  mutate(difference = signif(difference, digits = 3)) %>% 
  kable
f <- "../data/processed/compareUnadjusted.csv"
results %>% write.csv(file = f, row.names = FALSE, na = "")
message(sprintf("File %s was written on %s", f, file.mtime(f)))
```

## Adjusted comparisons

Adjusted for **orifice area.**
  
  Calculate mean (SD) and ranges.
Calculate differences in means.
Adjust p-values for multiple comparisons.

```{r}
covar <- "orificeAreaScaled"
results <- 
  rbind(compare("bsa", "Body surface area", covar = covar),
        compare("nr_frac", "NR fraction", covar = covar),
        compare("rl_frac", "RL fraction", covar = covar),
        compare("ln_frac", "LN fraction", covar = covar),
        compare("total_area_value", "Total coaptation area, value", covar = covar),
        compare("total_area", "Total coaptation area, calculated", covar = covar),
        # compare("orifice_area", "Orifice area", covar = covar),
        compare("valve_diameter", "Valve diameter", covar = covar),
        compare("valve_area", "Valve area", covar = covar),
        compare("a_coap_size_valve", "Total valve coaptation area relative to valve diameter", covar = covar),
        compare("a_coap_orifice_area", "Total valve coaptation area relative to orifice area", covar = covar),
        compare("a_coap_valve_area", "Total valve coaptation area relative to valve area", covar = covar),
        compare("magnitude", "Coaptation line length", covar = covar),
        compare("centroidCalcRotatedX", "Ceiling centroid point X-coordinate", covar = covar),
        compare("centroidCalcRotatedY", "Ceiling centroid point Y-coordinate", covar = covar)) %>%
  mutate(pAdjust = p.adjust(pValue, method = "BH"),
         sig = pAdjust < 0.05) %>% 
  .[names(.) %>% grep("formula", ., invert = TRUE, value = TRUE) %>% c("formula")]
```

Output results.
Results save as [CSV](../data/processed/compareAdjusted.csv).

```{r}
results %>% 
  select(matches("variable|diff|pAdjust|sig")) %>% 
  mutate(difference = signif(difference, digits = 3),
         seDiff = signif(seDiff, digits = 3),
         pAdjust = signif(pAdjust, digits = 3)) %>% 
  kable
f <- "../data/processed/compareAdjusted.csv"
results %>% write.csv(file = f, row.names = FALSE, na = "")
message(sprintf("File %s was written on %s", f, file.mtime(f)))
```
