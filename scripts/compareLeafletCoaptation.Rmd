# Compare leaflet coaptation fractions

Comparison variables are

* `nr_frac` Fraction of coaptation area between non-coronary and right coronary leaflets of total coaptation area
* `rl_frac` Fraction of coaptation area between right and left coronary leaflets of total coaptation area
* `ln_frac` Fraction of coaptation area between left coronary and non-coronary leaflets of total coaptation areas

[PNG](../figures/lineplotsLeafletsCoapFrac.png), [SVG](../figures/lineplotsLeafletCoapFrac.svg)

![Line plot](../figures/lineplotsLeafletsCoapFrac.png)

```{r lineplotsLeafletsCoapFrac, fig.show = "hide"}
var <- "^id|^type$|_frac$"
df1 <-
  df %>%
  select(matches(var)) %>%
  melt(id.vars = c("id", "type")) %>% 
  mutate(type = factor(type)) %>% 
  rename(frac = value) %>% 
  mutate(variable = factor(variable,
                           levels = c("nr_frac", "rl_frac", "ln_frac"),
                           labels = c("Non-coronary\nRight", "Right\nLeft", "Left\nNon-corronary")))
breaks <- c(0, 0.2, 1/3, 0.4, 0.6)
df1 %>% 
  ggplot +
  aes(x = variable, y = frac, color = type) +
  geom_hline(yintercept = 1/3) +
  geom_line(alpha = 1/4, aes(group = id)) +
  geom_boxplot(alpha = 1/2, aes(fill = type)) +
  # geom_point(alpha = 1/2, aes(group = id)) +
  scale_x_discrete("") +
  scale_y_continuous("", breaks = breaks, labels = sprintf("%.02f", breaks)) +
  scale_color_brewer("", palette = "Set1") +
  scale_fill_brewer("", palette = "Set1") +
  facet_wrap(~ type) +
  labs(title = "Fraction of coaptation area between leaflets") + 
  theme_bw() +
  theme(legend.position = "none",
        panel.grid.major.x = element_blank(),
        plot.title = element_text(hjust = 0.5))
ggsave("../figures/lineplotsLeafletsCoapFrac.png", dpi = 300, height = 4, width = 8, units = "in")
ggsave("../figures/lineplotsLeafletsCoapFrac.svg", dpi = 300, height = 4, width = 8, units = "in")
```

Use a linear model to test if leaflet fractions are different.

```{r}
M <- 
  df1 %>% 
  lm(frac ~ type + variable + type * variable, data = .)
p <- 
  rbind(data.frame(contrast = "Cases: NR vs LN", 
                   p = pContrast(M, matrix(c(0, 0, 0, 1, 0, 0), 1))),
        data.frame(contrast = "Cases: RL vs NR & LN", 
                   p = pContrast(M, matrix(c(0, 0, 1, 0, 0, 0), 1))),
        data.frame(contrast = "Controls: NR vs LN", 
                   p = pContrast(M, matrix(c(0, 0, 0, 0.5, 0, 0.5), 1))),
        data.frame(contrast = "Controls: RL vs NR & LN", 
                   p = pContrast(M, matrix(c(0, 0, 0.5, 0, 0.5, 0), 1))),
        data.frame(contrast = "Controls: NR vs RL vs LN", 
                   p = pContrast(M, matrix(c(0, 0, 0.5, -0.5, 0.5, -0.5), 1))),
        data.frame(contrast = "RL: Cases vs Controls", 
                   p = pContrast(M, matrix(c(0, 0.5, 0, 0, 0.5, 0), 1))))
```

* Among cases
  * NR and LN are `r paste0(isSig(p[1, "p"]), "ly")` different (p = `r sprintf("%.03f", p[1, "p"])`)
  * RL is `r paste0(isSig(p[2, "p"]), "ly")` different from NR and LN (p = `r sprintf("%.03f", p[2, "p"])`)
* Among controls
  * NR and LN are `r paste0(isSig(p[3, "p"]), "ly")` different (p = `r sprintf("%.03f", p[3, "p"])`)
  * RL is `r paste0(isSig(p[4, "p"]), "ly")` different from NR and LN (p = `r sprintf("%.03f", p[4, "p"])`)
  * NR, RL, and LN are `r paste0(isSig(p[5, "p"]), "ly")` different from each other (p = `r sprintf("%.03f", p[5, "p"])`)
* Between cases and controls
  * RL is `r paste0(isSig(p[6, "p"]), "ly")` different (p = `r sprintf("%.03f", p[6, "p"])`)

```{r}
p %>% kable
tidy(M) %>% kable(digits = 3)
```
